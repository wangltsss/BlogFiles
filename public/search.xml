<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Java多线程的学习笔记(Multithreading in Java)(未完)</title>
      <link href="/2022/01/23/Java%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
      <url>/2022/01/23/Java%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="写在前边"><a href="#写在前边" class="headerlink" title="写在前边"></a>写在前边</h1><p>前一阵子想用Java从头开始写一个自己的网站，于是找了一个教程。教程的第一步就是入门servlet<br>，自己了解了一下发现需要熟悉多线程。正好这学期有一门课是以C语言为基础讲并发系统的，干脆自己在研究一下Java多线程。</p><span id="more"></span><h1 id="多线程基础"><a href="#多线程基础" class="headerlink" title="多线程基础"></a>多线程基础</h1><p>在计算机中，通常运行的每个应用被叫做一个进程(Process)。而每个进程可以包含多个子进程，叫做线程(Thread)。例如在音乐播放器中，播放音乐需要一个线程，显示歌词又需要一个线程。一个进程至少包含一个线程，也可以包含多个线程。</p><h1 id="Java的多线程"><a href="#Java的多线程" class="headerlink" title="Java的多线程"></a>Java的多线程</h1><h2 id="多线程流程"><a href="#多线程流程" class="headerlink" title="多线程流程"></a>多线程流程</h2><p>在创建Thread实例后，线程会等待<code>start()</code>的执行以进入就绪状态(Ready)。</br><br>进入就绪状态后，该线程会处于就绪队列中，等待被调度。 </br><br>当该就绪状态的线程获取CPU资源后，就可以调用<code>run()</code>方法，此时该线程处于运行状态(Running)。</br><br>当一个线程占用资源时间耗尽，或者主动执行<code>wait()</code>等方法后，就会进入阻塞状态(Blocked)。处于阻塞状态的线程再重新获取CPU资源之前，会一直处于阻塞状态。</p><h2 id="新建Thread实例"><a href="#新建Thread实例" class="headerlink" title="新建Thread实例"></a>新建<code>Thread</code>实例</h2><p>可以通过</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadRunnable</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"><span class="comment">/* override run() method */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">/* */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"><span class="comment">/* override run() method */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">/* */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="线程的同步"><a href="#线程的同步" class="headerlink" title="线程的同步"></a>线程的同步</h2><h3 id="原子-atomic-操作"><a href="#原子-atomic-操作" class="headerlink" title="原子(atomic)操作"></a>原子(atomic)操作</h3><p>语句如</br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n = n + <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>看似为单个语句，但其实其中至少包含了三步:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 不标准的Assembly.</span><br><span class="line">ld sp(0), x5// suppose stack pointer is pointing to n and load it into x5.</span><br><span class="line">addi x5, x5, 1// n = n + 1.</span><br><span class="line">sd x5, sp(0)// save n = n + 1 back.</span><br></pre></td></tr></table></figure><p>原子操作为不可被分割的指令，如:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n;   <span class="comment">//---  addi sp sp -8make room on the stack for one int.</span></span><br></pre></td></tr></table></figure><h3 id="多线程中共享变量-shared-variable-的问题"><a href="#多线程中共享变量-shared-variable-的问题" class="headerlink" title="多线程中共享变量(shared variable)的问题"></a>多线程中共享变量(shared variable)的问题</h3><p>如果将<code>n</code>初始化为0，同时创建两个线程，一个线程（线程1）负责执行10000次<code>n += 1</code>，另一个（线程2）负责执行10000次<code>n -= 1</code>，最后<code>n</code>的值每次都会不同。</br><br>这是因为，非常可能地，在线程1读取到<code>n = 0</code>后，线程2立刻抢占了CPU资源，并且同样读取到了<code>n = 0</code>（因为线程1还来不及对<code>n</code>做修改），并且执行了<code>n -= 1</code>并存储回<code>n</code>。此时线程1重新获得资源，但此时线程1已经进行过读取操作（<code>n = 0</code>），所以最后经过<code>n += 1</code>和<code>n -= 1</code>后，<code>n</code>此时的值为1.</p><h3 id="synchronized关键字"><a href="#synchronized关键字" class="headerlink" title="synchronized关键字"></a>synchronized关键字</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock object)&#123;</span><br><span class="line"><span class="comment">// clauses</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&#123;</code>会自动为<code>synchronized</code>内部的语句加锁，而<code>&#125;</code>会自动解锁。</br><br>注意，<code>lock</code>实例与<code>synchronized</code>内部的语句无关，该lock实例可以为任何对象的实例。<br>在<code>synchronized</code>结构中归属于同一个<code>lock</code>实例的语句不能被同时执行。</p>]]></content>
      
      
      <categories>
          
          <category> Pogramming&amp;Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Multithreading </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Latex技巧总结(更新中)</title>
      <link href="/2022/01/23/Latex%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93/"/>
      <url>/2022/01/23/Latex%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这篇文章主要记录一些用LaTeX写作时常用的环境以及数学公式，一来方便自己需要时查阅，二来也给有需要的人提供一点便利。</p><p><strong>注意</strong>，这篇文章假设你了解LaTeX的基本知识，所以没有LaTeX的详细教学。</p><span id="more"></span><h1 id="文本类"><a href="#文本类" class="headerlink" title="文本类"></a>文本类</h1><h2 id="Description环境"><a href="#Description环境" class="headerlink" title="Description环境"></a>Description环境</h2><p><strong>大象</strong>&nbsp;&nbsp;&nbsp;&nbsp;一种动物。</br></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\begin&#123;description&#125;</span><br><span class="line">\item&#123;大象&#125; 一种动物。</span><br><span class="line">\end&#123;description&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><h3 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h3><ol><li>第一项</li><li>第二项</li><li>第三项</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\begin&#123;enumerate&#125;</span><br><span class="line">\item[] 第一项</span><br><span class="line">\item[] 第二项</span><br><span class="line">\item[] 第三项</span><br><span class="line">\end&#123;enumerate&#125;</span><br></pre></td></tr></table></figure><h3 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h3><p>形如:</br></p><ul><li>subsubsub</li><li>supsupsup</li><li>puspuspus</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\begin&#123;itemize&#125;</span><br><span class="line">\item[] subsubsub</span><br><span class="line">\item[] supsupsup</span><br><span class="line">\item[] puspuspus</span><br><span class="line">\end&#123;itemize&#125;</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;[]内可指定自定义行符。</p><hr><h1 id="数学类"><a href="#数学类" class="headerlink" title="数学类"></a>数学类</h1>]]></content>
      
      
      <categories>
          
          <category> Dictionaries </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LaTeX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pyserial的使用心得</title>
      <link href="/2022/01/23/Pyserial%E5%BA%93%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/"/>
      <url>/2022/01/23/Pyserial%E5%BA%93%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/</url>
      
        <content type="html"><![CDATA[<h1 id="关于Pyserial"><a href="#关于Pyserial" class="headerlink" title="关于Pyserial"></a>关于Pyserial</h1><p>Pyserial库封装了访问串口的方法。它为在Windows，OSX，Linux，BSD和IronPython上运行的Python提供后端。<code>serial</code>对象会自动选择合适的后端。<br>This module encapsulates the access for the serial port. It provides backends for Python running on Windows, OSX, Linux, BSD (possibly any POSIX compliant system) and IronPython. The module named “serial” automatically selects the appropriate backend.</p><span id="more"></span><h1 id="Pyserial库的安装"><a href="#Pyserial库的安装" class="headerlink" title="Pyserial库的安装"></a>Pyserial库的安装</h1><p>将python版本更新到2.7及以上，或3.4及以上，然后直接使用pip安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyserial</span><br></pre></td></tr></table></figure><h1 id="Serial对象"><a href="#Serial对象" class="headerlink" title="Serial对象"></a>Serial对象</h1><p>导入pyserial包后使用serial.Serial创建。<br>此处因为业务需要，需要同时在windows和linux或macos下访问此应用。<br>在windows和linux中，端口名称不相同。<br>在windows下，端口名形如【COMx】（x为整数）；<br>在linux下，端口名形如【/dev/xxxxx】（x为具体端口名）。<br>因此还引入了platform来判断系统以获取不同系统下的端口。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import serial</span><br><span class="line"></span><br><span class="line">def create_connection(self, port):</span><br><span class="line">        if self._system.lower() == &quot;darwin&quot;:</span><br><span class="line">            self.ser = serial.Serial(port=&quot;/dev/&#123;&#125;&quot;.format(port),</span><br><span class="line">                                     baudrate=115200, #波特率</span><br><span class="line">                                     bytesize=8, #字节大小</span><br><span class="line">                                     stopbits=1) #停止位</span><br><span class="line">        elif self._system.lower() == &quot;windows&quot;:</span><br><span class="line">            self.ser = serial.Serial(port=port,</span><br><span class="line">                                     baudrate=115200,</span><br><span class="line">                                     bytesize=8,</span><br><span class="line">                                     stopbits=1)</span><br></pre></td></tr></table></figure><p>此处应根据实际业务需求设置【校验位】，【超时时间】等属性。</p><h2 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a>常用属性</h2><p>以下为Serial对象所有的属性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">port: str #端口名</span><br><span class="line">baudrate: int #波特率</span><br><span class="line">bytesize #可能的值：FIVEBITS, SIXBITS, SEVENBITS, EIGHTBITS</span><br><span class="line">parity #可能的值：PARITY_NONE, PARITY_EVEN, PARITY_ODD PARITY_MARK, PARITY_SPACE</span><br><span class="line">stopbits #可能的值：STOPBITS_ONE, STOPBITS_ONE_POINT_FIVE, STOPBITS_TWO</span><br><span class="line">timeout: float #超时时长</span><br><span class="line">xonxoff: bool #软件流控制的开关</span><br><span class="line">rtscts: bool #硬件(RTS/CTS)流控制的开关</span><br><span class="line">dsrdtr: bool #硬件(DSR/DTR)流控制的开关</span><br><span class="line">write_timeout: float #输出的超时时间</span><br><span class="line">inter_byte_timeout: float #字符间隔超时时长，默认设置为None以禁用</span><br><span class="line">in_waiting: int #返回输入缓冲区（待接收）中的字符数量</span><br><span class="line">out_waiting: int #返回输出缓冲区（待发送）中的字符数量</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>其中【port】【baudrate】【bytesize】【parity】【stopbits】【in_waiting】很常用。</li><li>【timeout】的设置会影响read()方法的行为：<ul><li>设置为None时，read()会一直从缓冲区中读取数据，直到指定的字符数量已被读取。</li><li>设置为0时，read()会立即返回读到的从0到指定数量的字符。</li><li>设置为x（x为整数）时，read()会在达到x秒时返回读到的所有字符，或在此之前返回指定数        量的字符。<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">def serial.tool.list_ports()</span><br><span class="line">&quot;&quot;&quot;返回所有检测到的串口</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">serial.Serial.open()</span><br><span class="line">&quot;&quot;&quot;打开串口</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">serial.Serial.close()</span><br><span class="line">&quot;&quot;&quot;关闭串口</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">serial.Serial.read(size=1)</span><br><span class="line">&quot;&quot;&quot;从串口中读取最多【size】个的字符</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">serial.Serial.write(data)</span><br><span class="line">&quot;&quot;&quot;向串口发送数据【data】,【data】的类型为bytes, bytearray或str。</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">serial.Serial.flush()</span><br><span class="line">&quot;&quot;&quot;等待所有数据发送完毕</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><p>封装案例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">import serial</span><br><span class="line"></span><br><span class="line">import serial.tools.list_ports</span><br><span class="line"></span><br><span class="line">import platform</span><br><span class="line"></span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class PortManager(object):</span><br><span class="line">&quot;&quot;&quot;操作串口的类</span><br><span class="line"></span><br><span class="line">    Attributes:</span><br><span class="line">        _system: str - 当前应用所在环境的系统类型</span><br><span class="line">        ser: serial.Serial - 串口链接的对象</span><br><span class="line">        _serial_port: str - 串口名称</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    _system = platform.system()</span><br><span class="line">    ser: serial.Serial</span><br><span class="line">    _serial_port: str</span><br><span class="line"></span><br><span class="line">    def set_port(self, port):</span><br><span class="line">    &quot;&quot;&quot;_serial_port的setter&quot;&quot;&quot;</span><br><span class="line">        self._serial_port = port</span><br><span class="line"></span><br><span class="line">    def get_port(self):</span><br><span class="line">    &quot;&quot;&quot;_serial_port的getter&quot;&quot;&quot;</span><br><span class="line">        return self._serial_port</span><br><span class="line"></span><br><span class="line">    def list_ports(self):</span><br><span class="line">    &quot;&quot;&quot;获取并返回所有的串口&quot;&quot;&quot;</span><br><span class="line">        list_p = list(serial.tools.list_ports.comports())</span><br><span class="line">        list_ports_name = []</span><br><span class="line">        if self._system.lower() == &quot;darwin&quot;:</span><br><span class="line">            list_ports_name = [str(i.name) for i in list_p]</span><br><span class="line">        elif self._system.lower() == &quot;windows&quot;:</span><br><span class="line">            list_ports_name = [str(i.device) for i in list_p]</span><br><span class="line">        return list_ports_name</span><br><span class="line"></span><br><span class="line">    def create_connection(self, port):</span><br><span class="line">    &quot;&quot;&quot;创建串口链接&quot;&quot;&quot;</span><br><span class="line">        if self._system.lower() == &quot;darwin&quot;:</span><br><span class="line">            self.ser = serial.Serial(port=&quot;/dev/&#123;&#125;&quot;.format(port),</span><br><span class="line">                                     baudrate=115200,</span><br><span class="line">                                     bytesize=8,</span><br><span class="line">                                     stopbits=1)</span><br><span class="line">        elif self._system.lower() == &quot;windows&quot;:</span><br><span class="line">            self.ser = serial.Serial(port=port,</span><br><span class="line">                                     baudrate=115200,</span><br><span class="line">                                     bytesize=8,</span><br><span class="line">                                     stopbits=1)</span><br><span class="line"></span><br><span class="line">    def send_data(self, value):</span><br><span class="line">    &quot;&quot;&quot;向串口发送数据&quot;&quot;&quot;</span><br><span class="line">        write_data = bytearray.fromhex(value)</span><br><span class="line">        try:</span><br><span class="line">            sleep(0.1)</span><br><span class="line">            if self.ser.out_waiting:</span><br><span class="line">                self.ser.reset_output_buffer()</span><br><span class="line">            if self.ser.write(write_data):</span><br><span class="line">                self.ser.flush()</span><br><span class="line">            else:</span><br><span class="line">                if self.ser.write(write_data):</span><br><span class="line">                    self.ser.flush()</span><br><span class="line">            self.ser.reset_output_buffer()</span><br><span class="line">            return True</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(e)</span><br><span class="line">            self.ser.reset_output_buffer()</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">    def read_data(self):</span><br><span class="line">    &quot;&quot;&quot;从串口读取数据&quot;&quot;&quot;</span><br><span class="line">        try:</span><br><span class="line">            sleep(0.1)</span><br><span class="line">            if self.ser.in_waiting:</span><br><span class="line">                bs = self.ser.read(self.ser.in_waiting).hex()</span><br><span class="line">                self.ser.reset_input_buffer()</span><br><span class="line">                res = &#x27;&#x27;</span><br><span class="line">                for i in range(len(bs)):</span><br><span class="line">                    res += bs[i]</span><br><span class="line">                    if i % 2 == 1:</span><br><span class="line">                        res += &#x27; &#x27;</span><br><span class="line">                res = res.rstrip(&#x27; &#x27;)</span><br><span class="line">                return res</span><br><span class="line">            else:</span><br><span class="line">                sleep(0.1)</span><br><span class="line">                if self.ser.in_waiting:</span><br><span class="line">                    bs = self.ser.read(self.ser.in_waiting).hex()</span><br><span class="line">                    self.ser.reset_input_buffer()</span><br><span class="line">                    res = &#x27;&#x27;</span><br><span class="line">                    for i in range(len(bs)):</span><br><span class="line">                        res += bs[i]</span><br><span class="line">                        if i % 2 == 1:</span><br><span class="line">                            res += &#x27; &#x27;</span><br><span class="line">                    res = res.rstrip(&#x27; &#x27;)</span><br><span class="line">                    return res</span><br><span class="line">                else:</span><br><span class="line">                    self.ser.reset_input_buffer()</span><br><span class="line">                    return &quot;&quot;</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(e)</span><br><span class="line">            self.ser.reset_input_buffer()</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">    def close(self, *ser):</span><br><span class="line">    &quot;&quot;&quot;关闭串口&quot;&quot;&quot;</span><br><span class="line">        if ser:</span><br><span class="line">            ser[0].close()</span><br><span class="line">        else:</span><br><span class="line">            self.ser.close()</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>这是用bootstrap构建的一个web app，主要用途是配置测试公司客制化的继电器板卡。<br>此app就是利用pyserial与串口通信。</p><p>配置组模式：<br><img src="https://img-blog.csdnimg.cn/77e1cb3e8a1f44a9bc17ebff2dd9ce4f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMDczMzMz,size_16,color_FFFFFF,t_70#pic_center" alt="配置组模式"></p><p>板卡控制面板：<br><img src="https://img-blog.csdnimg.cn/7ab9122042ec4ef789ae30cf09504336.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMDczMzMz,size_16,color_FFFFFF,t_70#pic_center" alt="板卡控制面板"></p><p>板卡配置面板：<br><img src="https://img-blog.csdnimg.cn/13190e0c95464b2f924fdde87921cd47.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMDczMzMz,size_16,color_FFFFFF,t_70#pic_center" alt="板卡配置面板"></p><p>连接错误处理：<br><img src="https://img-blog.csdnimg.cn/83a747f39605441f80378d995b55463d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMDczMzMz,size_16,color_FFFFFF,t_70#pic_center" alt="错误处理"></p><p>多板卡级联时的板卡切换：<br><img src="https://img-blog.csdnimg.cn/cae4af3ecaab4583a4fadaa91a2e8575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMDczMzMz,size_16,color_FFFFFF,t_70#pic_center" alt="多板卡级联的切换板卡"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在CentOS 8上部署基于Flask实现的项目</title>
      <link href="/2022/01/23/%E9%83%A8%E7%BD%B2Flask%E9%A1%B9%E7%9B%AE/"/>
      <url>/2022/01/23/%E9%83%A8%E7%BD%B2Flask%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>写这篇文章是因为我在自己部署项目的时候，遇到了很多仅靠别人的博客和回答解决不了的问题。于是在自己解决了之后，就希望能够详细的记录下来，既能方便其他可能跟我一样基础比较差的人，也预防将来的自己忘掉了，又得一遍遍的翻枯燥的官方文档。</p><span id="more"></span><h1 id="关于服务器"><a href="#关于服务器" class="headerlink" title="关于服务器"></a>关于服务器</h1><p>我购买的是阿里云的服务器，今年618期间很便宜，最低配置的60块不到就能买上一年。<br>操作系统我选择了CentOS 8。原因无他，一直以来用的都是Cent OS，且更高的版本号意味着更好的兼容性与稳定性（测试版除外）。</p><h1 id="关于环境"><a href="#关于环境" class="headerlink" title="关于环境"></a>关于环境</h1><p>以下这些操作，建议在本地电脑完成之后，再使用git同步到服务器端。</p><p>非常不建议用户直接使用root账户来进行以下操作。</p><p>非常建议用户创建一个有sudo权限的账户来进行以下操作。</p><h2 id="python版本"><a href="#python版本" class="headerlink" title="python版本"></a>python版本</h2><p>在Cent OS下，建议直接使用yum命令进行下载。yum命令提供了4个版本的python可供下载:</p><ul><li>python2 </li><li>python36</li><li>python38</li><li>python39</li></ul><p> 例如下载python 3.9时，直接使用命令<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install python39</span><br></pre></td></tr></table></figure><br> 如果提示权限不够记得加上sudo。</p><p> 版本可以根据个人使用习惯来进行选择。我个人一直使用的是python 3.8。</p><p>不推荐使用python2，尽管我看到的很多教程都说python 2与Flask和uWSGI相性更佳，但实际使用下来python3也完全没有出现不兼容的问题。</p><h2 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><p>为什么要创建虚拟环境？</p><p>虚拟环境的好处在于安装在其中的插件不会影响到你电脑上的本地配置，也独立于其他的虚拟环境。例如当你的一个项目需要Fabric 1.x，而另一个需要Fabric 2.x的时候，如果你使用了虚拟环境，他们互相不会冲突。但如果不使用虚拟环境，你就需要删掉其中一个版本，再安装另一个版本以避免兼容性问题。</p><p>在python 3中，官方文档建议用户使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv (/path to new virtual environment)</span><br></pre></td></tr></table></figure><p>命令来创建虚拟环境。</p><p>例如，你可以使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv venv</span><br></pre></td></tr></table></figure><p>来在当前目录下创建一个目录名为venv的虚拟环境。</p><p>创建完成之后，进入到venv文件，使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ./bin/activate</span><br></pre></td></tr></table></figure><p>来激活虚拟环境，处在虚拟环境中时，直接输入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure><p>来退出虚拟环境。</p><h2 id="依赖包"><a href="#依赖包" class="headerlink" title="依赖包"></a>依赖包</h2><p>这一步需要等你的Flask项目已经万事俱备，只差部署到服务器端的时候再操作，写在这里只是因为与上边的一块内容有些许关联。</p><p>用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure><p>命令可以提取当前所有依赖包，并将其写入requirements.txt文件中，这样在服务器端安装时，可以直接使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requiremtns.txt</span><br></pre></td></tr></table></figure><p>安装你在本地电脑上的所有依赖包。<br>需要注意的是如果提示权限不够，pip的官方文档并不提倡使用sudo，而是建议用户使用“ –user ”参数。这个参数的含义是将包安装到用户主目录，而非python的安装目录下。</p><h1 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h1><p>由于nginx在近几年变得越来越流行，现在yum的库里已经包含了nginx，不再需要我们手动添加了。</p><p>直接使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install nginx</span><br></pre></td></tr></table></figure><p>来安装。</p><p>安装完可以使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -v</span><br></pre></td></tr></table></figure><p>命令来检查是否安装成功。</p><p>以下是几个常用命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable nginx //开机启动nginx</span><br><span class="line">sudo systemctl start nginx //启动nginx</span><br><span class="line">sudo systemctl stop nginx //关闭nginx</span><br><span class="line">sudo systemctl restart nginx //重新加载nginx</span><br><span class="line">sudo systemctl status nginx //查看nginx状态</span><br></pre></td></tr></table></figure><p>关于nginx的配置问题会在最后讲解。</p><h1 id="安装uwsgi"><a href="#安装uwsgi" class="headerlink" title="安装uwsgi"></a>安装uwsgi</h1><p>关于uwsgi的作用以及他与nginx的区别，想要了解的可以参考这篇文章：<br><a href="https://www.dazhuanlan.com/2019/10/11/5d9f74310baf0/">nginx和uwsgi的区别和作用</a>.<br>文章讲的很好，也很详细，我就不在此赘述了。</p><p>安装uwsgi可以使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install uwsgi</span><br></pre></td></tr></table></figure><p>命令直接进行安装。</p><p>安装完之后可以使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --version</span><br></pre></td></tr></table></figure><p>命令来确认是否安装成功。</p><p>uwsgi的配置问题也会在最后讲解。</p><h1 id="部署到服务器"><a href="#部署到服务器" class="headerlink" title="部署到服务器"></a>部署到服务器</h1><p>连接到你的服务器，进入到你想要放置你项目位置的文件夹。</p><p>如果对此犹豫不决，我建议你就放在你当前用户的主目录下。</p><p>按个人喜好，使用git或者scp或者ftp传输工具将项目上传到服务器上。</p><p>如果你的服务器上没有跟你本地版本相同的python，你需要在服务器端再次重复上述安装python的步骤。</p><p>在确保python版本一致之后，你可以使用上边的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p>来安装所有依赖包了。</p><h2 id="uwsgi初始化文件"><a href="#uwsgi初始化文件" class="headerlink" title="uwsgi初始化文件"></a>uwsgi初始化文件</h2><p>在你项目的根目录创建一个.ini文件，名称最好能体现他的作用，例如uwsgi.ini或项目名.ini。<br>在里边写上如下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">socket=127.0.0.1:5000 //你可以选择不同的端口，下边还会用到。</span><br><span class="line"></span><br><span class="line">chdir=/home/wst/wms //你的项目的根目录</span><br><span class="line"></span><br><span class="line">wsgi-file=app.py //你的启动文件，注意这里是相对项目根目录的地址。</span><br><span class="line"></span><br><span class="line">callable=app //启动文件实例的名称</span><br><span class="line"></span><br><span class="line">processes=4 </span><br><span class="line"></span><br><span class="line">threads=2</span><br><span class="line"></span><br><span class="line">master=true</span><br><span class="line"></span><br><span class="line">stats=127.0.0.1:9191</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>以上标有注释的请根据实际情况修改，无注释的，也没有需求理解这些参数的可以照抄。</p><p>修改完后记得删掉我的注释。</p><h2 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h2><p>nginx的配置文件” nginx.conf “通常存在于” /etc/nginx “目录下，如果你找不到，可以使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure><p>命令来查看他的位置。</p><p>使用文本编辑器打开它</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>会看到类似下面的代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"># For more information on configuration, see:</span><br><span class="line">#   * Official English Documentation: http://nginx.org/en/docs/</span><br><span class="line">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span><br><span class="line"></span><br><span class="line">user nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 2048;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 default_server;</span><br><span class="line">        listen       [::]:80 default_server;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">            location = /40x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">            location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># Settings for a TLS enabled server.</span><br><span class="line">#</span><br><span class="line">#    server &#123;</span><br><span class="line">#        listen       443 ssl http2 default_server;</span><br><span class="line">#        listen       [::]:443 ssl http2 default_server;</span><br><span class="line">#        server_name  _;</span><br><span class="line">#        root         /usr/share/nginx/html;</span><br><span class="line">#</span><br><span class="line">#        ssl_certificate &quot;/etc/pki/nginx/server.crt&quot;;</span><br><span class="line">#        ssl_certificate_key &quot;/etc/pki/nginx/private/server.key&quot;;</span><br><span class="line">#        ssl_session_cache shared:SSL:1m;</span><br><span class="line">#        ssl_session_timeout  10m;</span><br><span class="line">#        ssl_ciphers PROFILE=SYSTEM;</span><br><span class="line">#        ssl_prefer_server_ciphers on;</span><br><span class="line">#</span><br><span class="line">#        # Load configuration files for the default server block.</span><br><span class="line">#        include /etc/nginx/default.d/*.conf;</span><br><span class="line">#</span><br><span class="line">#        location / &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#</span><br><span class="line">#        error_page 404 /404.html;</span><br><span class="line">#            location = /40x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#</span><br><span class="line">#        error_page 500 502 503 504 /50x.html;</span><br><span class="line">#            location = /50x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将” server “内的” server_name “改成你的域名或者公网地址；</p><p>在” root “下增加两行，分别为”access_log”和”error_log”；</p><p>在” location / “内启用” uwsgi_params “。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80 default_server;</span><br><span class="line">    listen       [::]:80 default_server;</span><br><span class="line">    server_name  xxx.xxx.xxx.xxx;</span><br><span class="line">    root         /usr/share/nginx/html;</span><br><span class="line">    access_log  /home/wst/wms/logs/access.log;</span><br><span class="line">    error_log  /home/wst/wms/logs/error.log;</span><br><span class="line"></span><br><span class="line">    # Load configuration files for the default server block.</span><br><span class="line">    include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">   include     uwsgi_params;</span><br><span class="line">    uwsgi_pass      127.0.0.1:5000; #这里与uwsgi配置文件里的socket保持一致</span><br><span class="line">     uwsgi_param UWSGI_PYHOME /home/wst/wms/venv; #python虚拟环境的地址</span><br><span class="line">     uwsgi_param UWSGI_CHDIR  /home/wst/wms; #项目根目录地址</span><br><span class="line">     uwsgi_param UWSGI_SCRIPT app:app; #启动脚本名:实例名</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">        location = /40x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure><p>命令检查是否有语法错误。</p><p>如果没有报错，输入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><p>在此之后，访问你的公网地址，你应该就能看到你的网页了。</p><p>下一步就是在服务器端启用监管以重启挂掉的程序，和使用fabric或jenkins来进行持续集成，避免每次在本地更新代码后，还需要进行冗余的操作来将其同步到云端。这部分内容我会在之后完成相应的工作后也写一篇博客记录。</p>]]></content>
      
      
      <categories>
          
          <category> Linux &amp; Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
